<!DOCTYPE html>
<html>
<head>
	<title>TEST</title>
	<link rel="stylesheet" href = "style.css">
</head>
<body>
	<h1>Welcome!</h1>
	<p>
		To begin, enter the source text below, then press "generate" to generate words from the text.
	</p>
	
	<h2>Input</h2>
	<input id = "sourceInput">
	<button onClick = "getSource()">SUBMIT</button>
	<br>
	<form>
		<input type = "radio" name = "type" value = "Word" id = "wordRadio" checked> Word
		<br>
		<input type = "radio" name = "type" value = "Sentence"> Sentence
	</form>
	<br>
	What Depth?<input id = "depthInput" value = "2">
	<br>
	<h2>Generation</h2>
	How many?<input id = "repInput" value = "10"><button onClick = "generate()">GENERATE</button>
	<br>
	<p id = "outputTest"></p>
</body>
<script>
	String.prototype.repeat = function( num )
	{
		return new Array( num + 1 ).join( this );
	}
	var genType = document.getElementById("wordRadio").checked;
	console.log("genType = "+genType);
	var chain = {};
	var depth = 2;
	var repeat = 0;
	
	function createChain(arr)
	{
		//Insert extra space to identify starts
		var beginning = [];
		for (i = 0; i < depth; i++)
		{
			beginning[i] = " ";
		}
		arr = beginning.concat(arr);
		
		//document.getElementById("debug").innerHTML += (arr.toString()+"<br>");
		
		for (i = 0; i < (arr.length + depth); i++)
		{
			key = arr.slice(i, i+depth).join("");
			val = arr[i+depth];
			if(!val){val="\n";}
			//console.log("chain["+key+"] = "+val)
			if (chain[key])
			{
				chain[key].push(val)
			}
			else
			{
				chain[key] = [val];
			}
		}
		
	}
	function getSource()
	{
		chain = {};
		var input = document.getElementById("sourceInput").value;
		depth = parseInt(document.getElementById("depthInput").value, 10);
		
		genType = document.getElementById("wordRadio").checked;
		var output = "Test";
		var words = input.split(" ");
		console.log("words = "+words.toString())
		if (genType)
		{
			console.log("Generating Words\n");
			
			for (i in words)
			{
				word = words[i]
				wordParts = word.split("");
				//console.log(wordParts.toString());
				createChain(wordParts);
			}
		}
		else
		{
			console.log("Generating Sentences!")
			
			createChain(words)
		}
	}
	
	function generate()
	{
		repeat = parseInt(document.getElementById("repInput").value, 10);
		output = "";
		console.log("Generating!")
		console.log(JSON.stringify(chain));
		for (x = 0; x < repeat; x++)
		{
			var s = "";
			
			var start = " ".repeat(depth);
			console.log("start = "+start)
			var current = start;
			var i = 0;
			var newS = "";
			while (newS != "\n")
			{
				i++;
				
				//console.log("chain[current] = '"+chain[current]+"'");
				//console.log("current.slice(1, depth) = '"+current.slice(1,depth)+"'")
				newS = chain[current][Math.floor(Math.random() * chain[current].length)]
				//console.log("newS = "+newS)
				current = current.slice(1, depth) + newS
				//console.log("current = "+current)
				s += newS;
				if (i > 50) { break }
			}
			console.log("string = "+s);
			output += (s+", ");
		}
		
		
		document.getElementById("outputTest").innerHTML = output;
	}
	</script> 
</html>